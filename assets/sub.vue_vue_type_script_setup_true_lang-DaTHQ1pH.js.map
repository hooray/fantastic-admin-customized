{"version":3,"file":"sub.vue_vue_type_script_setup_true_lang-DaTHQ1pH.js","sources":["../../src/layouts/components/Menu/sub.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport type { OverlayScrollbarsComponentRef } from 'overlayscrollbars-vue'\nimport type { SubMenuProps } from './types'\nimport { useTimeoutFn } from '@vueuse/core'\nimport { OverlayScrollbarsComponent } from 'overlayscrollbars-vue'\nimport Item from './item.vue'\nimport { rootMenuInjectionKey } from './types'\n\ndefineOptions({\n  name: 'SubMenu',\n})\n\nconst props = withDefaults(\n  defineProps<SubMenuProps>(),\n  {\n    level: 0,\n  },\n)\n\nconst index = props.menu.path ?? JSON.stringify(props.menu)\nconst itemRef = useTemplateRef('itemRef')\nconst subMenuRef = useTemplateRef<OverlayScrollbarsComponentRef>('subMenuRef')\nconst rootMenu = inject(rootMenuInjectionKey)!\n\nconst opened = computed(() => {\n  return rootMenu.openedMenus.includes(props.uniqueKey.at(-1)!)\n})\nconst alwaysOpened = computed(() => {\n  return rootMenu.alwaysOpenedsMenus.includes(props.uniqueKey.at(-1)!)\n})\n\nconst transitionEvent = computed(() => {\n  return rootMenu.isMenuPopup\n    ? {\n        enter(el: HTMLElement) {\n          if (el.offsetHeight > window.innerHeight) {\n            el.style.height = `${window.innerHeight}px`\n          }\n        },\n        afterEnter: () => {},\n        beforeLeave: (el: HTMLElement) => {\n          el.style.overflow = 'hidden'\n          el.style.maxHeight = `${el.offsetHeight}px`\n        },\n        leave: (el: HTMLElement) => {\n          el.style.maxHeight = '0'\n        },\n        afterLeave(el: HTMLElement) {\n          el.style.overflow = ''\n          el.style.maxHeight = ''\n        },\n      }\n    : {\n        enter(el: HTMLElement) {\n          const memorizedHeight = el.offsetHeight\n          el.style.maxHeight = '0'\n          el.style.overflow = 'hidden'\n          void el.offsetHeight\n          el.style.maxHeight = `${memorizedHeight}px`\n        },\n        afterEnter(el: HTMLElement) {\n          el.style.overflow = ''\n          el.style.maxHeight = ''\n        },\n        beforeLeave(el: HTMLElement) {\n          el.style.overflow = 'hidden'\n          el.style.maxHeight = `${el.offsetHeight}px`\n        },\n        leave(el: HTMLElement) {\n          el.style.maxHeight = '0'\n        },\n        afterLeave(el: HTMLElement) {\n          el.style.overflow = ''\n          el.style.maxHeight = ''\n        },\n      }\n})\n\nconst transitionClass = computed(() => {\n  return rootMenu.isMenuPopup\n    ? {\n        enterActiveClass: 'ease-in-out duration-300',\n        enterFromClass: 'opacity-0 translate-x-4',\n        enterToClass: 'opacity-100',\n        leaveActiveClass: 'ease-in-out duration-300',\n        leaveFromClass: 'opacity-100',\n        leaveToClass: 'opacity-0',\n      }\n    : {\n        enterActiveClass: 'ease-in-out duration-300',\n        enterFromClass: 'opacity-0 translate-y-4 scale-95 blur-4',\n        enterToClass: 'opacity-100 translate-y-0 scale-100 blur-0',\n        leaveActiveClass: 'ease-in-out duration-300',\n        leaveFromClass: 'opacity-100 translate-y-0 scale-100 blur-0',\n        leaveToClass: 'opacity-0 translate-y-4 scale-95 blur-4',\n      }\n})\n\nconst hasChildren = computed(() => {\n  let flag = true\n  if (props.menu.children) {\n    if (props.menu.children.every((item: any) => item.meta?.menu === false)) {\n      flag = false\n    }\n  }\n  else {\n    flag = false\n  }\n  return flag\n})\n\nfunction handleClick() {\n  if (alwaysOpened.value) {\n    return\n  }\n  if (rootMenu.isMenuPopup && hasChildren.value) {\n    return\n  }\n  if (hasChildren.value) {\n    rootMenu.handleSubMenuClick(index, props.uniqueKey)\n  }\n  else {\n    rootMenu.handleMenuItemClick(index)\n  }\n}\n\nlet timeout: (() => void) | undefined\n\nfunction handleMouseenter() {\n  if (!rootMenu.isMenuPopup) {\n    return\n  }\n  rootMenu.mouseInMenu = props.uniqueKey\n  timeout?.()\n  ;({ stop: timeout } = useTimeoutFn(() => {\n    if (hasChildren.value) {\n      rootMenu.openMenu(index, props.uniqueKey)\n      nextTick(() => {\n        const el = itemRef.value?.ref\n        if (!el) {\n          return\n        }\n        let top = 0\n        let left = 0\n        if (rootMenu.props.mode === 'vertical' || props.level !== 0) {\n          top = el.getBoundingClientRect().top + el.scrollTop\n          left = (rootMenu.props.direction === 'ltr' ? el.getBoundingClientRect().left : document.documentElement.clientWidth - el.getBoundingClientRect().right) + el.getBoundingClientRect().width\n          if (top + subMenuRef.value!.getElement()!.offsetHeight > window.innerHeight) {\n            top = window.innerHeight - subMenuRef.value!.getElement()!.offsetHeight\n          }\n        }\n        else {\n          top = el.getBoundingClientRect().top + el.getBoundingClientRect().height\n          left = rootMenu.props.direction === 'ltr' ? el.getBoundingClientRect().left : document.documentElement.clientWidth - el.getBoundingClientRect().right\n          if (top + subMenuRef.value!.getElement()!.offsetHeight > window.innerHeight) {\n            subMenuRef.value!.getElement()!.style.height = `${window.innerHeight - top}px`\n          }\n        }\n        if (left + subMenuRef.value!.getElement()!.offsetWidth > document.documentElement.clientWidth) {\n          left = (rootMenu.props.direction === 'ltr' ? el.getBoundingClientRect().left : document.documentElement.clientWidth - el.getBoundingClientRect().right) - el.getBoundingClientRect().width\n        }\n        subMenuRef.value!.getElement()!.style.top = `${top}px`\n        subMenuRef.value!.getElement()!.style.insetInlineStart = `${left}px`\n      })\n    }\n    else {\n      const path = props.menu.children ? rootMenu.subMenus[index].indexPath.at(-1)! : rootMenu.items[index].indexPath.at(-1)!\n      rootMenu.openMenu(path, rootMenu.subMenus[path].indexPath)\n    }\n  }, 300))\n}\n\nfunction handleMouseleave() {\n  if (!rootMenu.isMenuPopup) {\n    return\n  }\n  rootMenu.mouseInMenu = []\n  timeout?.()\n  ;({ stop: timeout } = useTimeoutFn(() => {\n    if (rootMenu.mouseInMenu.length === 0) {\n      rootMenu.closeMenu(props.uniqueKey)\n    }\n    else {\n      if (hasChildren.value) {\n        !rootMenu.mouseInMenu.includes(props.uniqueKey.at(-1)!) && rootMenu.closeMenu(props.uniqueKey.at(-1)!)\n      }\n    }\n  }, 300))\n}\n</script>\n\n<template>\n  <Item ref=\"itemRef\" :unique-key=\"uniqueKey\" :item=\"menu\" :level=\"level\" :sub-menu=\"hasChildren\" :expand=\"opened\" :always-expand=\"alwaysOpened\" @click=\"handleClick\" @mouseenter=\"handleMouseenter\" @mouseleave=\"handleMouseleave\" />\n  <Teleport v-if=\"hasChildren\" to=\"body\" :disabled=\"!rootMenu.isMenuPopup\">\n    <Transition v-bind=\"transitionClass\" v-on=\"transitionEvent\">\n      <OverlayScrollbarsComponent\n        v-show=\"opened\" ref=\"subMenuRef\" :options=\"{ scrollbars: { visibility: 'hidden' } }\" defer class=\"sub-menu static\" :class=\"{\n          'bg-[var(--g-sub-sidebar-bg)]': rootMenu.isMenuPopup,\n          'ring-1 ring-stone-2 dark-ring-stone-8 shadow-xl fixed! z-3000 w-[200px]': rootMenu.isMenuPopup,\n          'mx-1': rootMenu.isMenuPopup && (rootMenu.props.mode === 'vertical' || level !== 0),\n          'py-1': rootMenu.isMenuPopup,\n          'rounded-lg': rootMenu.props.rounded,\n        }\"\n      >\n        <template v-for=\"item in menu.children\" :key=\"item.path ?? JSON.stringify(item)\">\n          <SubMenu v-if=\"item.meta?.menu !== false\" :unique-key=\"[...uniqueKey, item.path ?? JSON.stringify(item)]\" :menu=\"item\" :level=\"level + 1\" />\n        </template>\n      </OverlayScrollbarsComponent>\n    </Transition>\n  </Teleport>\n</template>\n"],"names":["props","__props","index","itemRef","useTemplateRef","subMenuRef","rootMenu","inject","rootMenuInjectionKey","opened","computed","alwaysOpened","transitionEvent","el","memorizedHeight","transitionClass","hasChildren","flag","item","_a","handleClick","timeout","handleMouseenter","useTimeoutFn","nextTick","top","left","path","handleMouseleave"],"mappings":"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"}