{"version":3,"file":"index.vue_vue_type_script_setup_true_lang-CA44mCgC.js","sources":["../../src/layouts/components/MenuPanel/index.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport type { MenuInjection, MenuProps } from './types'\nimport Item from './item.vue'\nimport SubMenu from './sub.vue'\nimport { rootMenuInjectionKey } from './types'\n\ndefineOptions({\n  name: 'MainMenu',\n})\n\nconst props = withDefaults(\n  defineProps<MenuProps>(),\n  {\n    mode: 'vertical',\n    collapse: false,\n    showCollapseName: false,\n    rounded: false,\n    direction: 'ltr',\n  },\n)\n\nconst activeIndex = ref<MenuInjection['activeIndex']>(props.value)\nconst items = ref<MenuInjection['items']>({})\nconst subMenus = ref<MenuInjection['subMenus']>({})\nconst openedMenus = ref<MenuInjection['openedMenus']>([])\nconst mouseInMenu = ref<MenuInjection['mouseInMenu']>([])\n\n// 解析传入的 menu 数据，并保存到 items 和 subMenus 对象中\nfunction initItems(menu: MenuProps['menu'], parentPaths: string[] = []) {\n  menu.forEach((item) => {\n    const index = item.path ?? JSON.stringify(item)\n    if (item.children) {\n      const indexPath = [...parentPaths, index]\n      subMenus.value[index] = {\n        index,\n        indexPath,\n        active: false,\n      }\n      initItems(item.children, indexPath)\n    }\n    else {\n      items.value[index] = {\n        index,\n        indexPath: parentPaths,\n      }\n    }\n  })\n}\n\nconst openMenu: MenuInjection['openMenu'] = (index) => {\n  if (openedMenus.value.includes(index)) {\n    return\n  }\n  openedMenus.value.push(index)\n}\nconst closeMenu: MenuInjection['closeMenu'] = (index) => {\n  if (Array.isArray(index)) {\n    nextTick(() => {\n      closeMenu(index.at(-1)!)\n      if (index.length > 1) {\n        closeMenu(index.slice(0, -1))\n      }\n    })\n    return\n  }\n  Object.keys(subMenus.value).forEach((item) => {\n    if (subMenus.value[item].indexPath.includes(index)) {\n      openedMenus.value = openedMenus.value.filter(item => item !== index)\n    }\n  })\n}\n\nfunction setSubMenusActive(index: string) {\n  for (const key in subMenus.value) {\n    subMenus.value[key].active = false\n  }\n  subMenus.value[index]?.indexPath.forEach((idx) => {\n    subMenus.value[idx].active = true\n  })\n  items.value[index]?.indexPath.forEach((idx) => {\n    subMenus.value[idx].active = true\n  })\n}\n\nconst handleMenuItemClick: MenuInjection['handleMenuItemClick'] = (index) => {\n  if (props.mode === 'horizontal' || props.collapse) {\n    openedMenus.value = []\n  }\n  setSubMenusActive(index)\n}\nconst handleSubMenuClick: MenuInjection['handleSubMenuClick'] = (index) => {\n  if (openedMenus.value.includes(index)) {\n    closeMenu(index)\n  }\n  else {\n    openMenu(index)\n  }\n}\n\nfunction initMenu() {\n  const activeItem = activeIndex.value && items.value[activeIndex.value]\n  setSubMenusActive(activeIndex.value)\n  if (!activeItem || props.collapse) {\n    return\n  }\n  // 展开该菜单项的路径上所有子菜单\n  activeItem.indexPath.forEach((index) => {\n    const subMenu = subMenus.value[index]\n    subMenu && openMenu(index)\n  })\n}\n\nwatch(() => props.menu, (val) => {\n  initItems(val)\n  initMenu()\n}, {\n  deep: true,\n  immediate: true,\n})\n\nwatch(() => props.value, (currentValue) => {\n  if (!items.value[currentValue]) {\n    activeIndex.value = ''\n  }\n  const item = items.value[currentValue] || (activeIndex.value && items.value[activeIndex.value]) || items.value[props.value]\n  if (item) {\n    activeIndex.value = item.index\n  }\n  else {\n    activeIndex.value = currentValue\n  }\n  initMenu()\n})\n\nwatch(() => props.collapse, (value) => {\n  if (value) {\n    openedMenus.value = []\n  }\n  initMenu()\n})\n\nprovide(rootMenuInjectionKey, reactive({\n  props,\n  items,\n  subMenus,\n  activeIndex,\n  openedMenus,\n  mouseInMenu,\n  openMenu,\n  closeMenu,\n  handleMenuItemClick,\n  handleSubMenuClick,\n}))\n</script>\n\n<template>\n  <div\n    class=\"h-full w-full flex flex-col of-hidden transition-all\" :class=\"{\n      'flex-row! w-auto!': props.mode === 'horizontal',\n      'py-1': props.mode === 'vertical',\n    }\"\n  >\n    <template v-for=\"item in menu\" :key=\"item.path ?? JSON.stringify(item)\">\n      <template v-if=\"item.meta?.menu !== false\">\n        <SubMenu v-if=\"item.children?.length\" :menu=\"item\" :unique-key=\"[item.path ?? (item.children.every(item => item.meta?.menu === false) ? item.children[0].path! : JSON.stringify(item))]\" />\n        <Item v-else :item=\"item\" :unique-key=\"[item.path ?? (item.children?.every(item => item.meta?.menu === false) ? item.children[0].path! : JSON.stringify(item))]\" @click=\"handleMenuItemClick(item.path ?? (item.children?.every(item => item.meta?.menu === false) ? item.children[0].path! : JSON.stringify(item)))\" />\n      </template>\n    </template>\n  </div>\n</template>\n"],"names":["props","__props","activeIndex","ref","items","subMenus","openedMenus","mouseInMenu","initItems","menu","parentPaths","item","index","indexPath","openMenu","closeMenu","nextTick","setSubMenusActive","key","_a","idx","_b","handleMenuItemClick","handleSubMenuClick","initMenu","activeItem","watch","val","currentValue","value","provide","rootMenuInjectionKey","reactive"],"mappings":"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"}